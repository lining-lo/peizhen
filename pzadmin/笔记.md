## 陪诊系统B端笔记

### 文档

- [Vite](https://vitejs.cn/vite5-cn/guide/)
- [Vue Router](https://router.vuejs.org/zh/guide/)
- [Element Plus](https://element-plus.org/zh-CN/#/zh-CN)
- [Vuex](https://vuex.vuejs.org/zh/)
- [Vant](https://vant-ui.github.io/vant/#/zh-CN)

### 目录

* [1. vite 初始化项目](#1-vite-初始化项目)
* [2. 路由配置](#2-路由配置)
* [3. 配置 Element Plus 按需引入](#3-配置-Element Plus-按需引入)
* [4. Main 组件 使用 layout 布局](#4-Main-组件-使用-layout-布局)
* [5. Menu 组件的编写](#5-Menu-组件的编写)
* [6. 点击菜单相应路由跳转](#6-点击菜单相应路由跳转)
* [7. Header 组件的编写](#7-Header-组件的编写)
* [8. 菜单的展开与折叠](#8-菜单的展开与折叠)
* [9. tag 标签功能的实现](#9-tag-标签功能的实现)
* [10. 登录组件的实现](#10-登录组件的实现)
* [11. axios 二次封装](#11-axios-二次封装)
* [12. 登录和注册功能](#12-登录和注册功能)
* [13. 用户鉴权](#13-用户鉴权)
* [14. 菜单管理组件](#14-菜单管理组件)
* [15. 账号管理组件及功能](#15-账号管理组件及功能)
* [16. 退出登录及动态菜单](#16-退出登录及动态菜单)
* [17. 陪护管理组件](#17-陪护管理组件)
* [18. 项目搭建及路由和 Vant 引入](#18-项目搭建及路由和-Vant-引入)
* [19. 引入 tabbar](#19-引入-tabbar)

#### 1. vite 初始化项目

```
1 创建项目：npm create vite@latest my-vue-app -- --template vue
2 下载依赖：nmp install
3 启动项目；npm run dev
```

#### 2. 路由配置

```
1 安装依赖：npm install vue-router@4
2 创建路由组件（views）
3 配置路由（router）
4 挂载到 vue 实例（app.use）
5 指定位置展示（RouterView）
```

#### 3. 配置 Element Plus 按需引入

```
1 安装依赖：element-plus、unplugin-vue-components、unplugin-auto-import
2 配置 vite.config.js
```

#### 4. Main 组件 使用 layout 布局

```
1 删除创建 vite 自带的样式
2 清除所有默认样式
3 使用 Element Plus 提供的 Container 容量布局搭建想要的效果
```

#### 5. Menu 组件的编写

```
1 思路：
	① 左侧的菜单项是根据配置的路由遍历生成的
	② 菜单可以使用 Element Plus 提供的 Menu 菜单实现
	③ 遍历菜单过程比较复杂，可以单独拆分成一个组件（组件递归实现）
2 实现步骤：
	① 编写路由
	② 根据路由创建相应的组件
	③ 编写菜单组件实现静态效果（Element Plus 提供的 Menu 菜单）
	④ 拆分组件，用组件递归实现动态的菜单项
3 注意：
	① 菜单的高度无法自适应屏幕高度 --> 需要逐层设置 height:100%;
	② 拆分组件时传递数据涉及父传子
	③ 组件递归传递传递的数据需要一致
	④ 需要使用Element Plus 提供的 icons 图标（使用<component :is="xxx">c）
```

#### 6. 点击菜单相应路由跳转

```
1 为每个菜单项绑定点击事件
2 创建 router 实例
3 点击事件 push 到相应的路由（之前的路由信息已经传递给 menu 菜单了，里面有 path）
4 指定位置展示（RouterView）
```

#### 7. Header 组件的编写

```
1 Header 组件结构是左右，内容居中，可以使用 flex 布局
2 左边是一个 icon 图标，后续要做展开与折叠左侧菜单的功能
3 右边是头像，下拉可以退出，可以用 Element Plus 提供的 Avatar 头像和 Dropdown 下拉菜单实现
```

#### 8. 菜单的展开与折叠

```
1 Element Plus 的 Menu 菜单提供了折叠与展开的方法（collapse），可以直接使用
2 点击 Heander 组件左侧图标，实现菜单的展开与折叠,需要一个变量来确定状态，其中涉及不同组件的通信，可以用 Vuex
3 实现步骤：
	① 在 vuex 中定义一个变量，默认为不展开（false）
	② 在 vuex 中定义一个方法，用来改变变量的状态（取反）
	③ 绑定点击事件，点击时调用 vuex 中的方法
```

#### 9. tag 标签功能的实现

```
1 功能描述：
	① 点击左侧菜单会在 Header 组件上面生成对应的 tag 标签
	② 当前标签与路由路径相同时，会高亮显示
	③ 点击 tag 标签可以实现路由跳转
	④ 点击 tag 标签的叉号可以删除当前标签
2 生成 tag 实现步骤：
	① 在仓库创建一个数组用来存点击的菜单信息
	② 在仓库创建一个添加菜单信息的方法（注意重复点击同一个菜单不能添加 --> 数组去重）
	③ 绑定点击事件，点击时点击时调用 vuex 中的方法
	④ 遍历展示 tag 标签
3 tag 高亮显示实现步骤：
	① 写一个 class 样式
	② 当当前的路由与 tag 的路径一致时添加上该样式（route.path === item.path）
4 tag 标签路由跳转实现步骤：通过 <router-link :to="item.path">{{ item.name }}</router-link> 实现
5 删除 tag 标签实现步骤：
	① 在仓库中创建一个从标签数组删除指定标签的方法
	② 绑定点击事件，执行仓库中的方法
	③ 删除后的逻辑判断：
		如果删除的不是当前标签 --> 不做处理；
		如果删除的是当前标签，而且是中间的标签，路由跳转到后一个标签；
		如果删除的是当前标签，并且是最后一个标签，并且前面还有标签，路由跳转到前一个标签；
		如果删除的是当前标签，并且是最后一个标签，并且前面没有标签，路由跳转首页；
```

#### 10. 登录组件的实现

```
1 功能描述：
	① 切换登录与注册：点击按钮可以切换登录与注册表单实现不同功能
	② 登录验证码：登录时可以通过手机发送短信收到验证码，点击发送验证码有一个倒计时效果
	③ 表单校验：失去焦点时要对账号和密码进行校验（Element-plus 的）
2 验证码功能实现步骤：
	① 定义一个对象，里面包含验证码的提示信息和倒计时间
	② 定义一个方法，用计时器实现倒计时效果，通过一个变量控制避免重复创建计时器
4 注意点：
	① Vue3 + Element-plus 在 input 框使用属性方式添加图标不显示的问题：首先图标要按需引入，通过 import { Avatar, Lock } from "@element-plus/icons-vue"; 其实引用的图标要通过Setup进行注册（最核心的一点）
```

#### 11. axios 二次封装

```
1 下载 axios 的依赖包
2 引入 axios
3 配置统一的 url 前缀和超时时间
4 配置请求拦截器：请求头上加上 token 信息（注意有的不用）
5 配置响应拦截器：报错时使用 Element Plus 的信息提示（要引入 Element Plus）
```

#### 12. 登录和注册功能

```
1 编写登录和注册的接口
2 表单提交时首先要进行校验（Element Plus）
3 校验通过后根据表单类型判断是登录还是注册
4 登录成功存入 token 和用户信息
4 注册成功切换登录表单
```

#### 13. 用户鉴权

```
1 用户未登录不能访问任何路由，且要跳转到登录页
2 成功登录会保存当前的 token 信息和用户信息
3 登录之后不能访问登录页面
4 token 过期要返回登录页面
5 通过前置路由守卫实现
```

#### 14. 菜单管理组件及功能

```
1 提示信息那块很多组件都在用，可以单独拆成一个组件，并注册成全局组件
2 菜单管理组件用到了 Element Plus 的很多功能
	① 点击的弹出框用到了 Dialog 对话框
    ② 展示的数据列表用到了 Table 表格
    ③ 数据分页用到了 Pagination 分页
    ④ 提交数据用到了 Form 表单
    ⑤ 选中权限用到了 Tree 树形控件
3 功能描述：
	① 添加功能：点击添加，弹出对话框，填写资料后提交可以添加信息
	② 数据列表：当路由到权限页时自动获取列表
	③ 修改功能：点击修改，弹出对话框，数据会自动回显，修改资料后提交可以修改信息
```

#### 15. 账号管理组件及功能

```
1 账号管理列表需要调用两个接口，一个是账号管理列表接口，一个是菜单权限下拉接口。
2 账号管理列表功能实现：
	① 编写两个接口，在挂载时调用获取数据
	② 数据处理：时间使用 dayjs 格式，所属组别要根据权限 id 去匹配相应名称
	③ 展示数据
3 用户编辑功能
```

#### 16. 退出登录及动态菜单

```
1 之前只写了登录，退出登录的逻辑还没写，退出登录只要清除浏览器存到 token 和用户信息并跳转到登录页面就行了。
2 之前的菜单是仓库里面写死的数据，因为每个用户的权限是不一样的，每个用户所展示的菜单也是不一样的。
3 动态菜单的实现：
	① 要实现动态菜单首先得获取这个用户所拥有的菜单权限（调接口）
	② 所获取的权限是一个数组，和之前的路由数据类似，但是引入的方式是不对的，所以我们拼接数据
	③ 拼接完成后通过 addRoute 添加到路由，删除之前写死的数据
4 一些问题：
	① 完成动态菜单后，一刷新页面就变成白屏 --> 因为 store 是挂载在 vue 实例上的，一刷新就销毁，而 store 上的数据会初始化，要解决这个问题可以将数据存在浏览器缓存中（我们这里使用 vuex-persistedstate）
	② 使用 vuex-persistedstate 后解决了刷新白屏的问题，但是当我们点击菜单时又发生白屏了 --> 因为动态路由是在登录时添加的，刷新后数据也初始化了，所以刷新后也得添加动态路由 
	③ 设置完缓存后，退出登录等相应代码也要修改
	④ 之前组件的提示信息那块内容也是写死的，这里我们要写成动态的 
	⑤ 头像问题 --> 头像信息之前也是写死的，这里我们改成动态的
	⑥ 刷新后选中的菜单项不高亮显示，也不回到首页 --> 高亮显示通过 default-active 属性控制，在仓库定义一个变量和一个控制变量的方法来实现；回到首页可以通过路由的重定向实现
```

#### 17. 陪护管理组件

```
1 陪护管理的功能和之前写的组件类似
2 陪护管理用到了 Element Plus 中的文件上传、数字输入框
3 具体功能逻辑与菜单管理和账号管理类似
```

#### 18. 项目搭建及路由和 Vant 引入

```
1 C端也是用 vite 来创建项目，过程和之前是一样的
2 项目创建完毕，要编写路由规则及搭建对应的路由组件
3 之前我们使用的是 Element Plus 组件库，在移动端我们使用 Vant 组件库
```

#### 19. 引入 tabbar 标签栏

```
1 Vant 组件库提供了 tabbar 标签栏，我们可以直接使用
2 通过 router 可以获取要使用的路由，然后遍历标签栏，通过 url 控制点击跳转到对应的l
```

